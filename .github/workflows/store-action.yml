name: Store CRUD Runner

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'create|read|update|delete|list'
        required: true
        default: 'list'
      id:
        required: false
        default: ''
      name:
        required: false
        default: ''
      email:
        required: false
        default: ''

jobs:
  run:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout
        uses: actions/checkout@v4

      # DOWNLOAD: restore previous store folder
      - name: Download store (if exists)
        uses: actions/download-artifact@v4
        with:
          name: store-artifact
          path: ./store
        continue-on-error: true

      - name: Ensure store folder exists
        run: mkdir -p ./store

      - name: Show restored files
        run: ls -la ./store || true

      - name: Make script executable
        run: chmod +x ./store_crud.sh

      - name: Run CRUD Operation
        env:
          ACTION: ${{ github.event.inputs.action }}
          ID: ${{ github.event.inputs.id }}
          NAME: ${{ github.event.inputs.name }}
          EMAIL: ${{ github.event.inputs.email }}
        run: |
          echo "Action: $ACTION"
          case "$ACTION" in
            create)
              ./store_crud.sh create --name "$NAME" --email "$EMAIL"
              ;;
            read)
              ./store_crud.sh read "$ID"
              ;;
            update)
              ./store_crud.sh update "$ID" --name "$NAME" --email "$EMAIL"
              ;;
            delete)
              ./store_crud.sh delete "$ID"
              ;;
            list)
              ./store_crud.sh list
              ;;
            *)
              echo "Unknown action"; exit 1 ;;
          esac

      # UPLOAD: save updated store folder for next run
      - name: Upload updated store
        uses: actions/upload-artifact@v4
        with:
          name: store-artifact
          path: ./store
